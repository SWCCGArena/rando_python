{% extends "base.html" %}

{% block content %}
<div class="dashboard">
    <!-- Status Panel -->
    <div class="panel status-panel">
        <h2>Bot Status</h2>
        <div class="status-indicator">
            <span id="status-text" class="status-text">{{ state.state }}</span>
            <span id="status-dot" class="dot"></span>
        </div>

        <div class="controls">
            <button id="btn-start" class="btn btn-primary" onclick="startBot()">Start Bot</button>
            <button id="btn-stop" class="btn btn-danger" onclick="stopBot()">Stop Bot</button>
        </div>

        <div id="error-message" class="error"></div>
    </div>

    <!-- Stats Panel - moved up for grid placement -->
    <div class="panel stats-panel">
        <h2>Astrogator Stats</h2>
        <div id="bot-stats">
            <table class="stats-table">
                <tr>
                    <td><strong>Total Games:</strong></td>
                    <td id="stats-total-games">0</td>
                </tr>
                <tr>
                    <td><strong>Wins:</strong></td>
                    <td id="stats-wins">0</td>
                </tr>
                <tr>
                    <td><strong>Losses:</strong></td>
                    <td id="stats-losses">0</td>
                </tr>
                <tr>
                    <td><strong>Win Rate:</strong></td>
                    <td id="stats-win-rate">0%</td>
                </tr>
                <tr>
                    <td><strong>Unique Players:</strong></td>
                    <td id="stats-players">0</td>
                </tr>
                <tr>
                    <td><strong>Achievements Awarded:</strong></td>
                    <td id="stats-achievements">0</td>
                </tr>
            </table>
        </div>
    </div>

    <!-- Configuration Panel -->
    <div class="panel config-panel">
        <h2>Configuration</h2>

        <div class="config-item">
            <label class="config-label">GEMP Server:</label>
            <select id="gemp-server-select" class="config-select" onchange="changeServer(this.value)">
                <option value="http://localhost:8082/gemp-swccg-server/" {% if 'localhost' in state.config.gemp_server %}selected{% endif %}>Local (localhost:8082)</option>
                <option value="https://gemp.starwarsccg.org/gemp-swccg-server/" {% if 'starwarsccg.org' in state.config.gemp_server %}selected{% endif %}>Production (gemp.starwarsccg.org)</option>
            </select>
            <span id="server-change-warning" class="warning-text" style="display: none; color: #f39c12; font-size: 0.8em;">⚠️ Stop bot first</span>
        </div>

        <div class="config-item">
            <label class="config-label">Bot Mode:</label>
            <span id="bot-mode" class="config-value">{{ state.config.bot_mode }}</span>
        </div>

        <div class="config-item">
            <label class="config-label">Auto-Start:</label>
            <input type="checkbox" id="auto-start-checkbox"
                   {% if state.config.auto_start %}checked{% endif %}
                   onchange="toggleAutoStart(this.checked)">
            <span class="config-hint" style="color: #888; font-size: 0.85em; margin-left: 8px;">Start bot automatically on server startup</span>
        </div>

        <div class="config-item">
            <label class="config-label">Table Name:</label>
            <span id="table-name-display" class="config-value">{{ state.config.table_name }}</span>
        </div>

        <h3 style="margin-top: 15px; margin-bottom: 5px; color: #888;">Strategy Config</h3>
        <div class="config-item">
            <label class="config-label">Config File:</label>
            <span id="strategy-config-name" class="config-value" style="color: #27ae60;">{{ state.config.strategy_config_name }}</span>
        </div>
        <div class="config-item">
            <label class="config-label">Version:</label>
            <span id="strategy-config-version" class="config-value">{{ state.config.strategy_config_version }}</span>
        </div>

        <h3 style="margin-top: 15px; margin-bottom: 5px; color: #888;">Key Parameters (Read-Only)</h3>
        <table class="config-table" style="width: 100%; font-size: 0.9em;">
            <tr>
                <td style="color: #888;">GamePlan:</td>
                <td id="cfg-gameplan">{{ state.config.gameplan_enabled }}</td>
                <td style="color: #888;">Chaos %:</td>
                <td id="cfg-chaos">{{ state.config.chaos_percent }}</td>
            </tr>
            <tr>
                <td style="color: #888;">Deploy Threshold:</td>
                <td id="cfg-deploy-threshold">{{ state.config.deploy_threshold }}</td>
                <td style="color: #888;">Battle Favorable:</td>
                <td id="cfg-battle-favorable">{{ state.config.battle_favorable_threshold }}</td>
            </tr>
            <tr>
                <td style="color: #888;">Hand Soft Cap:</td>
                <td id="cfg-hand-soft-cap">{{ state.config.hand_soft_cap }}</td>
                <td style="color: #888;">Max Hand Size:</td>
                <td id="cfg-max-hand">{{ state.config.max_hand_size }}</td>
            </tr>
            <tr>
                <td style="color: #888;">Force Gen Target:</td>
                <td id="cfg-force-gen">{{ state.config.force_gen_target }}</td>
                <td style="color: #888;">Early Game Turns:</td>
                <td id="cfg-early-turns">{{ state.config.early_game_turns }}</td>
            </tr>
        </table>
        <p style="color: #666; font-size: 0.8em; margin-top: 10px;">
            ℹ️ Strategy parameters are loaded from config file. Edit configs/production.json to change.
        </p>
    </div>

    <!-- Tables Panel (Phase 2) -->
    <div class="panel tables-panel">
        <h2>Hall Tables</h2>
        <div id="tables-list">
            <p class="placeholder">Not connected to GEMP server (Phase 2)</p>
        </div>

        <div class="create-table-form">
            <h3>Table Management</h3>
            <input type="text" id="new-table-name" placeholder="Bot Table" value="{{ state.config.table_name }}">
            <select id="deck-select">
                <option value="Hunt Down And Destroy The Jedi">Hunt Down (Dark)</option>
                <option value="Your Insight Serves You Well">Insight (Light)</option>
            </select>
            <button id="btn-create-table" class="btn btn-secondary" onclick="createTable()">Create Table</button>
            <button id="btn-leave-table" class="btn btn-danger" onclick="leaveTable()" style="display: none;">Leave Table</button>
        </div>
    </div>

    <!-- Game State Panel (Phase 4+) -->
    <div class="panel game-panel">
        <h2>Game State</h2>
        <div id="game-state">
            <p class="placeholder">No game in progress</p>
        </div>
        <div id="board-state-summary" style="display: none; margin-top: 15px;">
            <h3>Board Summary</h3>
            <table class="state-table">
                <tr>
                    <td><strong>Phase:</strong></td>
                    <td id="bs-phase">-</td>
                    <td><strong>My Turn:</strong></td>
                    <td id="bs-my-turn">-</td>
                </tr>
                <tr>
                    <td><strong>My Side:</strong></td>
                    <td id="bs-my-side">-</td>
                    <td><strong>Force:</strong></td>
                    <td id="bs-force">-</td>
                </tr>
                <tr>
                    <td><strong>Reserve:</strong></td>
                    <td id="bs-reserve">-</td>
                    <td><strong>Hand:</strong></td>
                    <td id="bs-hand">-</td>
                </tr>
                <tr>
                    <td><strong>My Power:</strong></td>
                    <td id="bs-my-power" class="power-value">-</td>
                    <td><strong>Their Power:</strong></td>
                    <td id="bs-their-power" class="power-value">-</td>
                </tr>
                <tr>
                    <td><strong>Locations:</strong></td>
                    <td id="bs-locations">-</td>
                    <td></td>
                    <td></td>
                </tr>
            </table>
        </div>
    </div>

    <!-- Board Visualization (Phase 4+) -->
    <div class="panel board-panel">
        <h2>Board State</h2>
        <pre id="board-visualization" class="board-viz">
<span class="placeholder">Waiting for game to start...</span>
        </pre>
    </div>

    <!-- Activity Log -->
    <div class="panel log-panel">
        <h2>Activity Log</h2>
        <div id="activity-log">
            <p class="log-entry"><span class="timestamp">[{{ "now"|default("--:--:--") }}]</span> <span class="log-msg">Bot initialized - Phase 5 (Strategic AI)</span></p>
        </div>
    </div>
</div>
{% endblock %}
